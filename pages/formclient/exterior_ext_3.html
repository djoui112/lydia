<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Exterior Project - Step 3</title>
  <link rel="stylesheet" href="../../css/project.css" />
</head>
<body>

  <div class="page-container">
    <header class="form-header">
      <button class="back-btn" onclick="window.location.href='exterior_ext_2.html'"><</button>
      <h1>Exterior Project</h1>
    </header>

    <div class="progress-bar">
      <div class="step completed">1</div>
      <div class="line completed"></div>
      <div class="step completed">2</div>
      <div class="line completed"></div>
      <div class="step completed">3</div>
      <div class="line completed"></div>
      <div class="step completed">4</div>
      <div class="line completed"></div>
      <div class="step active">5</div>
      <div class="line"></div>
      <div class="step">6</div>
    </div>

    <form class="application-form">
      <label>Special Requirements</label>
      <textarea placeholder="Any specific requirements or features you need (e.g., parking, accessibility, energy efficiency)..." rows="4" required></textarea>

      <label>Environmental Considerations</label>
      <input type="text" placeholder="e.g., Solar panels, Green roof, Rainwater collection" required>

      <label>Preferred Contact Method</label>
      <div class="form-group">
        <div class="choice-group">
          <button type="button" class="choice">Phone call</button>
          <button type="button" class="choice">Email</button>
          <button type="button" class="choice">WhatsApp</button>
        </div>
      </div>

      <label>Additional Notes</label>
      <textarea placeholder="Any additional information about your exterior project..." rows="4"></textarea>

      <button type="button" class="next-btn" onclick="handleProjectRequestSubmit(event)"> Submit </button>
    </form>
  </div>
  <script src="../../js/project.js"></script>
  <script src="../../js/form-persistence.js"></script>
  <script src="../../js/form-validation.js"></script>
  <script src="../../js/form-submission.js"></script>
  <script>
    // Handle project request form submission
    async function handleProjectRequestSubmit(event) {
      const form = event.target.closest('form');
      
      // Validate form first
      if (form && typeof validateForm === 'function' && !validateForm(form)) {
        event.preventDefault();
        event.stopPropagation();
        return false;
      }
      
      // Save form data before submitting
      if (typeof saveFormData === 'function') {
        saveFormData();
      }
      
      // Get agency_id from URL and save it
      const urlParams = new URLSearchParams(window.location.search);
      const agencyId = urlParams.get('agency_id');
      if (agencyId && typeof saveAgencyId === 'function') {
        saveAgencyId(agencyId);
      }
      
      // Save special requirements and additional notes
      const specialRequirements = form.querySelector('textarea[placeholder*="specific requirements"]');
      const additionalNotes = form.querySelector('textarea[placeholder*="additional information"]');
      
      if (specialRequirements) {
        localStorage.setItem('form-exterior_special_requirements', specialRequirements.value);
      }
      if (additionalNotes) {
        const currentDesc = localStorage.getItem('form-description') || '';
        localStorage.setItem('form-description', currentDesc + (currentDesc ? '\n\n' : '') + additionalNotes.value);
      }
      
      // Submit project request
      const success = await submitProjectRequest();
      
      if (success) {
        // Navigate to success page
        window.location.href = 'exterior_ext_success.html';
      } else {
        // Show error message
        alert('Failed to submit project request. Please try again.');
      }
    }
  </script>
</body>
</html>

